{% extends 'base.html' %} {% load static %} {% block content %}

<!-- ========================= SECTION: How Civic Connect Works ========================= -->
<section class="section-intro py-5 bg-light">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold">How Civic Connect Works?</h2>
      <p class="text-muted lead">Submit your issues in 3 simple steps</p>
    </div>

    <div class="row justify-content-center text-center align-items-center">
      <!-- Step 1 -->
      <div class="col-md-3 mb-4">
        <div class="card h-100 shadow border-0 rounded-lg">
          <div class="card-body">
            <div class="mb-3">
              <i class="fa fa-users fa-3x text-primary"></i>
            </div>
            <h5 class="fw-bold">Register/Login</h5>
            <p class="text-muted small">
              Sign up and verify to access the platform.
            </p>
          </div>
        </div>
      </div>

      <!-- Arrow -->
      <div class="col-md-1 d-none d-md-block">
        <i class="fa fa-arrow-right fa-2x text-dark"></i>
      </div>

      <!-- Step 2 -->
      <div class="col-md-3 mb-4">
        <div class="card h-100 shadow border-0 rounded-lg">
          <div class="card-body">
            <div class="mb-3">
              <i class="fa fa-bullhorn fa-3x text-success"></i>
            </div>
            <h5 class="fw-bold">Submit Complaint</h5>
            <p class="text-muted small">
              Choose your municipality, write your issue, and attach optional
              images or video.
            </p>
          </div>
        </div>
      </div>

      <!-- Arrow -->
      <div class="col-md-1 d-none d-md-block">
        <i class="fa fa-arrow-right fa-2x text-dark"></i>
      </div>

      <!-- Step 3 -->
      <div class="col-md-3 mb-4">
        <div class="card h-100 shadow border-0 rounded-lg">
          <div class="card-body">
            <div class="mb-3">
              <i class="fa fa-check-circle fa-3x text-warning"></i>
            </div>
            <h5 class="fw-bold">Track & Resolve</h5>
            <p class="text-muted small">
              Authorities will respond. Track status and receive resolution
              updates.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========================= SECTION: Popular Posts ========================= -->
<section class="section-name py-4">
  <div class="container">
    {% include 'includes/alerts.html' %}
    <header class="mb-4 d-flex justify-content-between align-items-center">
      <h3 class="section-title">Popular Posts</h3>
      <a href="{% url 'all_complaints'%}" class="btn btn-outline-primary btn-sm"
        >See all</a
      >
    </header>
    <div class="row">
      {% for complaint in complaints %} {% if not complaint.is_hidden %}
      <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm position-relative">
          <!-- Status Badge -->
          <span
            class="badge position-absolute top-0 end-0 m-2 {% if complaint.status %} {% if complaint.status.name == 'Pending' %} bg-danger text-white {% elif complaint.status.name == 'In Progress' %} bg-warning text-dark {% elif complaint.status.name == 'Resolved' %} bg-success text-white {% else %} bg-secondary text-white {% endif %} {% else %} bg-secondary text-white {% endif %}"
          >
            {{ complaint.status.name|default:"N/A" }}
          </span>

          <!-- Image -->
          {% if complaint.image %}
          <img
            src="{{ complaint.image.url }}"
            class="card-img-top"
            alt="Post media"
            style="height: 300px; object-fit: contain"
          />
          {% else %}
          <img
            src="{% static 'images/complain.png' %}"
            class="card-img-top"
            alt="No image"
            style="height: 300px; object-fit: contain"
          />
          {% endif %}

          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ complaint.title }}</h5>

            <p class="text-muted mb-2" style="font-size: 1rem">
              <strong>Date:</strong> {{ complaint.created_at|date:"Y-m-d" }}<br />
              <strong>Posted by:</strong> {{ complaint.user.username }}<br />
              <strong>Municipality:</strong> {{ complaint.ward|default:"N/A"}}<br />
              <strong>Ward:</strong> {% if complaint.ward %}Ward-{{complaint.ward.ward_number }}{% else %}N/A{% endif %}<br />
              <strong>Category:</strong> {{ complaint.category.category_name|default:"N/A" }}
            </p>

            <p class="card-text flex-grow-1">
              {{ complaint.description|truncatewords:20 }}
              <a
                href="{% url 'post_detail' complaint.id %}"
                class="text-primary"
                >View more</a
              >
            </p>

            <div
              class="d-flex justify-content-between align-items-center mt-auto"
            >
              <!-- Like Button -->
              {% if user != complaint.user %}
              <form
                method="POST"
                action="{% url 'like_complaint' complaint.id %}"
              >
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="fas fa-heart"></i> {{ complaint.likes.count }}
                </button>
              </form>
              {% else %}
              <button class="btn btn-sm btn-outline-danger" disabled>
                <i class="fas fa-heart"></i> {{ complaint.likes.count }}
              </button>
              {% endif %}

              <!-- Comment Button -->
              {% if user != complaint.user %}
              <a href="{% url 'post_detail' complaint.id %}">
                <button class="btn btn-sm btn-outline-secondary">
                  <i class="fas fa-comments"></i> {{ complaint.comments.count }}
                </button>
              </a>
               {% else %}
                <button class="btn btn-sm btn-outline-secondary" disabled>
                  <i class="fas fa-comments"></i> {{ complaint.comments.count }}
                </button>
                {% endif %}

              <!-- Report Button -->
              {% if user != complaint.user %}
              <form
                method="POST"
                action="{% url 'report_complaint' complaint.id %}"
              >
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-warning">
                  <i class="fas fa-flag"></i> {{ complaint.reports.count }}
                </button>
              </form>
              {% else %}
              <button class="btn btn-sm btn-outline-warning" disabled>
                <i class="fas fa-flag"></i> {{ complaint.reports.count }}
              </button>
              {% endif %}

              {% if user == complaint.user %}
              <form
                method="POST"
                action="{% url 'report_complaint' complaint.id %}"
              >
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-edit"></i> {{ complaint.reports.count }}
                </button>
              </form>
              {% else %}
              <button class="btn btn-sm btn-outline-primary" disabled>
                <i class="fas fa-edit"></i> {{ complaint.reports.count }}
              </button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endif %} {% empty %}
      <p>No complaints found.</p>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}
